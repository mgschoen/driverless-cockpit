<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<!-- Layout imports -->
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<!-- App logic -->
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<!-- Library components -->
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">

<!-- Custom components -->

<dom-module id="fsd-map-app">
  <template>
    <style include="typography"></style>
    <style include="app-grid-style">
      :host {

        /* Color definitions */
        --app-primary-color: rgba(50,50,50,1);
        --app-background-color: rgba(204,204,204,1);
        --app-lighttext-color: rgba(255,255,255,1);
        --app-highlight-color: rgba(190,22,33,1);

        /* Grid config */
        --app-grid-columns: 3;
        --app-grid-expandible-item-columns: 3;
        --app-grid-gutter: 20px;

        /* Fonts */
        font-family: 'Roboto', Arial, sans-serif;
      }

      app-toolbar.main {
        background: var(--app-primary-color);
        color: var(--app-lighttext-color);
        position: fixed;
        top: 0;
        width: 100%;
      }

      app-toolbar paper-progress {
        width: 100%;
        --paper-progress-active-color: var(--app-highlight-color);
      }

      paper-card {
        width: 100%;
      }

      paper-card.dashboard-box {
        --paper-card-background-color: var(--app-primary-color);
        --paper-card-header-color: var(--app-lighttext-color);
        --paper-card-content: {
          color: var(--app-lighttext-color);
        }
      }

      .dashboard-box-header {
        @apply (--paper-font-headline);
      }

      .content {
        margin: auto 10px;
      }

      .map {
        @apply --app-grid-expandible-item;
        height: 500px;
        background: var(--app-background-color);
      }

      #logo {
        background: var(--app-primary-color);
        display: inline-block;
        --iron-image-height: 60px;
      }

      #main-title {
        margin-left: 10px;
        vertical-align: 80%;
      }
    </style>

    <!-- Ajax controller -->
    <iron-ajax id="vehiclestatsRequest"
               auto url="/vehiclestats"
               handle-as="json"
               on-response="handleVehiclestats"
               last-response="{{ajaxResponse}}"></iron-ajax>

    <!-- App header -->
    <app-toolbar class="title-toolbar nav-title-toolbar spacer"></app-toolbar>
    <app-toolbar class="title-toolbar nav-title-toolbar main">
      <div main-title>
        <iron-image id="logo" src="/static/hm-logo.png" preload fade></iron-image>
        <span id="main-title">Cockpit</span>
      </div>
      <paper-progress value="0" indeterminate="{{false}}" bottom-item></paper-progress>
    </app-toolbar>

    <!-- App content -->
    <div class="app-grid">

      <!-- 1st row -->
      <div class="map">map</div>

      <!-- 2nd row -->
      <div id="stats">
        <paper-card class="dashboard-box">
          <div class="card-content">
            <div class="dashboard-box-header">
              <iron-icon icon="editor:insert-chart"></iron-icon>
              Stats
            </div>
            <pre>
steerAngle: {{steerAngle}}
pathMiddleX: {{pathMiddleX}}
pathMiddleY: {{pathMiddleY}}
vehicleX: {{vehicleX}}
vehicleY: {{vehicleY}}
          </pre>
          </div>
        </paper-card>
      </div>

      <div id="settings">
        <paper-card class="dashboard-box">
          <div class="card-content">
            <div class="dashboard-box-header">
              <iron-icon icon="build"></iron-icon>
              Settings
            </div>
          </div>
        </paper-card>
      </div>

      <div id="other"></div>
    </div>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class FsdMapApp extends Polymer.Element {
      static get is() { return 'fsd-map-app'; }
      static get properties() {
        return {
          steerAngle: {
            type: Number,
            value: 0.0
          },
          pathMiddleX: {
            type: Number,
            value: 0.0
          },
          pathMiddleY: {
            type: Number,
            value: 0.0
          },
          vehicleX: {
            type: Number,
            value: 0.0
          },
          vehicleY: {
            type: Number,
            value: 0.0
          },
          ajaxResponse: {
            type: Object
          }
        };
      }

      handleVehiclestats (e) {

        if (e.type !== 'response') {
          throw new Error('Failed to get vehicle statistics from server');
        } else {
          var res = this.ajaxResponse;
          this.steerAngle = res.steerAngle;
          this.pathMiddleX = res.pathMiddleX;
          this.pathMiddleY = res.pathMiddleY;
          this.vehicleX = res.vehicleX;
          this.vehicleY = res.vehicleY;
          var root = this.shadowRoot;
          setTimeout(function(){
            root.querySelector('#vehiclestatsRequest').generateRequest();
          }, 500)
        }
      }
    }

    window.customElements.define(FsdMapApp.is, FsdMapApp);
  </script>
</dom-module>
